import{d as O,a as R,_ as U,r as n,o as G,w as H,O as x,H as I,P as q,h as p,j as J,k as K,s as a,l as s,m as u,n as c,G as v,t as W,Q as F,u as V,f as C,R as $,F as X,S as Z,T as ee,I as te}from"./index-83f5659e.js";import{d as le}from"./api.analysis-95095a50.js";const oe={class:"calendar-main"},ne=["onClick"],ae={class:"day-count"},se=["onClick"],ue=["onClick"],ve=O({__name:"CalendarChart",setup(re){const T=R(()=>U(()=>import("./MonthAnalysis-64bb5a4c.js"),["./MonthAnalysis-64bb5a4c.js","./index-83f5659e.js","./index-6b4fc47c.css","./api.analysis-95095a50.js","./MonthAnalysis-a9ec9243.css"],import.meta.url)),M=n(new Date),A=async e=>await le(e),d=n({}),y=n({}),m=n({}),_=n({}),w=(e,t)=>{console.log(e),console.log(g);let o=k(e.day),i=k(g.value.selectedDay);console.log(o,i),o==i&&(console.log(o),Z(),C.startDay=e.day,C.endDay=e.day,t&&(C.flowType=t),M.value=new Date(e.day),ee.value.visible=!0)},r=n(new Date),g=n(),b=e=>{g.value&&(g.value.selectDate(e),e=="prev-month"?r.value.setMonth(r.value.getMonth()-1):e=="next-month"?r.value.setMonth(r.value.getMonth()+1):r.value=new Date,x(I("YYYY-MM",r.value)).then(t=>{f.value=t}))},k=e=>{let t=new Date(e),o=t.getFullYear().toString(),i=(t.getMonth()+1).toString();return o+" 年 "+i+" 月"},f=n({}),E=e=>!e||e==0?"no-flow":e>=1e3?"thousand-flow":e>=500?"five-hundred-flow":"have-flow",Q=e=>!e||e==0?"no-in":"have-in",N=()=>{m.value={},_.value={},d.value={},y.value={},A({}).then(e=>{e.length===0&&te.error("暂无数据"),e.forEach(t=>{let o=k(t.day);y.value[t.day]=t.daySum;let i=d.value[o]?d.value[o]:0;d.value[o]=i+Number(t.daySum),_.value[t.day]=t.inSum;let Y=m.value[o]?m.value[o]:0;m.value[o]=Y+Number(t.inSum)})}),x(I("YYYY-MM",r.value)).then(e=>{f.value=e})},B=e=>f.value.limitMoney&&d.value[e]>f.value.limitMoney?"color:red":"";N();let P=localStorage.getItem("bookId");G(()=>{setInterval(()=>{(P!=localStorage.getItem("bookId")||localStorage.getItem("changePlan")==="true")&&(P=localStorage.getItem("bookId"),N(),localStorage.setItem("changePlan","false"))},500)}),H(q,()=>{x(I("YYYY-MM",r.value)).then(e=>{f.value=e})});const D=n(!1),S=n(""),j=e=>{D.value=!0,S.value=e};return(e,t)=>{const o=p("el-button"),i=p("el-button-group"),Y=p("el-row"),z=p("el-calendar"),L=p("el-dialog");return J(),K(X,null,[a("div",oe,[s(z,{ref_key:"refCalendar",ref:g,modelValue:M.value,"onUpdate:modelValue":t[3]||(t[3]=l=>M.value=l)},{header:u(({date:l})=>[a("span",null,[c(v(l)+"   总收入：",1),a("b",null,v(m.value[l]?Number(m.value[l]).toFixed(2):0),1),c("   总支出："),a("b",{style:W(B(l))},v(d.value[l]?Number(d.value[l]).toFixed(2):0),5),c("   支出限额："),a("b",null,v(f.value.limitMoney),1),c("   "),s(o,{type:"primary",onClick:h=>j(l)},{default:u(()=>[c("分析")]),_:2},1032,["onClick"])]),s(Y,{class:"mini-button-group"},{default:u(()=>[s(i,null,{default:u(()=>[s(o,{onClick:t[0]||(t[0]=h=>b("prev-month"))},{default:u(()=>[c("上个月")]),_:1}),s(o,{onClick:t[1]||(t[1]=h=>b("today"))},{default:u(()=>[c("今天")]),_:1}),s(o,{onClick:t[2]||(t[2]=h=>b("next-month"))},{default:u(()=>[c("下个月")]),_:1})]),_:1})]),_:1})]),"date-cell":u(({data:l})=>[a("div",{onClick:h=>w(l),class:"day-container"},[a("span",{class:F(["day-title",l.day===V(C).startDay?"is-selected":""]),style:{flex:"1"}},v(l.day.split("-").slice(1).join("-"))+" "+v(l.day===V(C).startDay?"✔️":""),3),a("div",ae,[a("span",{class:F(Q(_.value[l.day])),onClick:$(h=>w(l,"收入"),["stop"])},v(_.value[l.day]&&_.value[l.day]>0?"收："+Number(_.value[l.day]).toFixed(2):" "),11,se),a("span",{class:F(E(y.value[l.day])),onClick:$(h=>w(l,"支出"),["stop"])},v(y.value[l.day]&&y.value[l.day]>0?"支："+Number(y.value[l.day]).toFixed(2):" "),11,ue)])],8,ne)]),_:1},8,["modelValue"])]),s(L,{style:{width:"30rem"},modelValue:D.value,"onUpdate:modelValue":t[4]||(t[4]=l=>D.value=l),title:S.value+" 流水分析","destroy-on-close":""},{default:u(()=>[s(V(T),{month:S.value},null,8,["month"])]),_:1},8,["modelValue","title"])],64)}}});export{ve as default};
