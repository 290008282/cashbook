import{d as O,r as d,o as Q,w as X,h as n,i as $,j as g,k as U,l,m as s,s as r,F,v as j,x as B,n as x,A as H,u as J,D as K,Y as L,I as V,Z as Y,a0 as Z,J as z,L as G,M as ee,N as le}from"./index-83f5659e.js";import{t as q}from"./flowConvert-1f6d50f4.js";const ae=y=>(G("data-v-988541b1"),y=y(),ee(),y),te={class:"queryParam"},oe={class:"queryParam"},ue={class:"queryParam"},se=ae(()=>r("hr",null,null,-1)),ne={class:"el-table-div"},de={class:"el-dialog-main"},ie={class:"dialog-footer"},re=O({__name:"TypeTable",setup(y){const C=d(!0),c=d("100px");document.body.clientWidth<=480&&(c.value="60px");const D=d([{value:"消费类型"},{value:"支付方式"}]),b=d([]),p=d({value:""}),u=d({type:"",value:""}),v=d({visible:!1,title:"类型改名"}),E=d({value:[{required:!0,message:"请输入类型新名称",trigger:"blur"}]}),T=d(),I=t=>{u.value.flowType=t.flowType,u.value.type=t.type,u.value.oldValue=t.value,u.value.value="",v.value.visible=!0},M=async t=>{if(t)if(await t.validate())L(u.value).then(e=>{e>0?V.success("修改成功，同步修改"+e+"条流水数据"):V.error("修改失败"),v.value.visible=!1,m()}).catch(e=>{V.error("修改失败"),console.log(e)});else return!1},R=()=>{var t;v.value.visible=!1,(t=T.value)==null||t.resetFields()},m=()=>{Y(p.value).then(t=>{b.value=t,C.value=!1}).catch(t=>{V.error("查询出错"),console.log(t)})};Q(()=>{m()}),X(p.value,()=>{m()});const N=async()=>{var i,w;const t=Z.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});let e="";for(let _=0;_<b.value.length;_++){let o=b.value[_];o.type==="消费类型"&&o.value!==q((i=o.value)==null?void 0:i.replace("-WX",""))&&(o.oldValue=o.value,o.value=q((w=o.value)==null?void 0:w.replace("-WX","")),e+=o.oldValue+"-->"+o.value,await L(o).then(k=>{k>0?e+=" success<br/>":e+=" fail<br/>"}))}z.alert(e.length===0?"没有类型需要转换":e,"转换结果",{confirmButtonText:"OK",center:!0,dangerouslyUseHTMLString:!0}).then(()=>{t.close(),m()}).catch(()=>{t.close(),m()})};return(t,e)=>{const i=n("el-input"),w=n("el-option"),_=n("el-select"),o=n("el-button"),k=n("el-row"),f=n("el-table-column"),S=n("el-table"),h=n("el-form-item"),W=n("el-form"),P=n("el-dialog"),A=$("loading");return g(),U(F,null,[l(k,{class:"queryRow"},{default:s(()=>[r("div",te,[l(i,{modelValue:p.value.value,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value.value=a),placeholder:"类型名称"},null,8,["modelValue"])]),r("div",oe,[l(_,{modelValue:p.value.type,"onUpdate:modelValue":e[1]||(e[1]=a=>p.value.type=a),class:"m-2",placeholder:"类型类型",clearable:""},{default:s(()=>[(g(!0),U(F,null,j(D.value,a=>(g(),B(w,{key:a.value,label:a.value,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),r("div",ue,[l(o,{type:"primary",onClick:N},{default:s(()=>[x("自动映射")]),_:1})])]),_:1}),se,r("div",ne,[H((g(),B(S,{data:b.value,"row-key":"row","max-height":"calc(100vh - 12rem)"},{default:s(()=>[l(f,{type:"index",label:"序号","min-width":"40"}),l(f,{prop:"flowType",label:"所属流水类型","min-width":"100"}),l(f,{prop:"type",label:"Type类型","min-width":"100"}),l(f,{prop:"value",label:"Type名称","min-width":"100"}),l(f,{label:"操作",width:"120"},{default:s(a=>[l(o,{type:"primary",icon:J(K),circle:"",onClick:pe=>I(a.row)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[A,C.value]])]),l(P,{style:{width:"20vw"},modelValue:v.value.visible,"onUpdate:modelValue":e[7]||(e[7]=a=>v.value.visible=a),title:v.value.title},{footer:s(()=>[r("span",ie,[l(o,{type:"primary",onClick:e[6]||(e[6]=a=>M(T.value))},{default:s(()=>[x(" 确定 ")]),_:1}),l(o,{onClick:R},{default:s(()=>[x(" 取消 ")]),_:1})])]),default:s(()=>[r("div",de,[l(W,{ref_key:"typeFormRef",ref:T,model:u.value,rules:E.value},{default:s(()=>[l(h,{label:"关联流水类型","label-width":c.value,prop:"flowType"},{default:s(()=>[l(i,{modelValue:u.value.flowType,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.flowType=a),disabled:""},null,8,["modelValue"])]),_:1},8,["label-width"]),l(h,{label:"原类型名称","label-width":c.value,prop:"value"},{default:s(()=>[l(i,{modelValue:u.value.oldValue,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.oldValue=a),disabled:""},null,8,["modelValue"])]),_:1},8,["label-width"]),l(h,{label:"新类型名称","label-width":c.value,prop:"value"},{default:s(()=>[l(i,{modelValue:u.value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.value=a)},null,8,["modelValue"])]),_:1},8,["label-width"]),l(h,{label:"类型类型","label-width":c.value,prop:"type"},{default:s(()=>[l(i,{modelValue:u.value.type,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.type=a),disabled:""},null,8,["modelValue"])]),_:1},8,["label-width"])]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","title"])],64)}}});const me=le(re,[["__scopeId","data-v-988541b1"]]);export{me as default};
